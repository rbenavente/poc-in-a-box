node {
 environment {
// def APOCTL_NAMESPACE ='/807152304871829504/cto-demo-rbc/demo-build'
// def APOCTL_CREDS = credentials('pipeline.cred')
TENANT='807152304871829504'
CLOUD='cto-demo-rbc'
GROUP='demo-build'
}

stage('Clone repository') {
checkout scm
}

stage('Download apoctl') {
sh "curl -o /usr/local/bin/apoctl https://download.aporeto.com/apoctl/linux/apoctl"
sh "sudo chmod +x /usr/local/bin/apoctl"
}

stage('Check if the authorization works') {
withCredentials([file(credentialsId: 'pipeline.creds', variable: 'APOCTL_CREDS')]){
 sh "apoctl auth verify"
}

}
stage('Deploy app and Policy as Code') {

sh "pwd"
sh "ls -la"
sh "echo ${TENANT}"
sh "echo $GROUP"
sh "echo $CLOUD"
sh "all/create"

}


}
